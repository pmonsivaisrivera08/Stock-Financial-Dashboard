<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Financial Dashboard - Demo en Vivo</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0e1117 0%, #262730 100%);
            color: #fafafa;
            min-height: 100vh;
        }

        .header {
            background: rgba(38, 39, 48, 0.9);
            padding: 1rem;
            border-bottom: 2px solid #00ff88;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            text-align: center;
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .container {
            display: flex;
            height: calc(100vh - 100px);
        }

        .sidebar {
            width: 300px;
            background: rgba(38, 39, 48, 0.9);
            padding: 2rem;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #00ff88;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            background: rgba(14, 17, 23, 0.8);
            color: #fafafa;
            font-size: 1rem;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #00ff88;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #0e1117;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #555;
            color: #aaa;
            cursor: not-allowed;
            transform: none;
        }

        .sample-stocks {
            margin-top: 2rem;
        }

        .sample-stocks h3 {
            color: #00ff88;
            margin-bottom: 1rem;
        }

        .sample-btn {
            width: 100%;
            padding: 0.75rem;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sample-btn:hover {
            background: rgba(0, 255, 136, 0.2);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: rgba(38, 39, 48, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .metric-title {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            color: #00ff88;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .metric-change {
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .metric-change.positive {
            color: #00ff88;
        }

        .metric-change.negative {
            color: #ff6b6b;
        }

        .chart-container {
            background: rgba(38, 39, 48, 0.8);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #00ff88;
        }

        .error {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            border-radius: 8px;
            padding: 1rem;
            color: #ff6b6b;
            margin: 1rem 0;
        }

        .success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 1rem;
            color: #00ff88;
            margin: 1rem 0;
        }

        .data-table {
            background: rgba(38, 39, 48, 0.8);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 2rem;
            overflow-x: auto;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            font-weight: bold;
        }

        .download-btn {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìà Stock Financial Dashboard</h1>
        <p style="text-align: center; margin: 0; opacity: 0.8;">Dashboard interactivo con datos reales de Yahoo Finance</p>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="input-group">
                <label for="symbolInput">S√≠mbolo de Acci√≥n</label>
                <input type="text" id="symbolInput" placeholder="ej. AAPL, GOOGL, MSFT" value="AAPL">
            </div>

            <div class="input-group">
                <label for="periodSelect">Per√≠odo</label>
                <select id="periodSelect">
                    <option value="1mo">1 Mes</option>
                    <option value="3mo">3 Meses</option>
                    <option value="6mo">6 Meses</option>
                    <option value="1y" selected>1 A√±o</option>
                    <option value="2y">2 A√±os</option>
                    <option value="5y">5 A√±os</option>
                </select>
            </div>

            <button class="btn" onclick="fetchStockData()" id="fetchBtn">
                üìä Obtener Datos
            </button>

            <div class="sample-stocks">
                <h3>Acciones Populares</h3>
                <button class="sample-btn" onclick="loadSampleStock('AAPL')">AAPL - Apple Inc.</button>
                <button class="sample-btn" onclick="loadSampleStock('GOOGL')">GOOGL - Alphabet Inc.</button>
                <button class="sample-btn" onclick="loadSampleStock('MSFT')">MSFT - Microsoft Corp.</button>
                <button class="sample-btn" onclick="loadSampleStock('TSLA')">TSLA - Tesla Inc.</button>
                <button class="sample-btn" onclick="loadSampleStock('AMZN')">AMZN - Amazon.com</button>
                <button class="sample-btn" onclick="loadSampleStock('NVDA')">NVDA - NVIDIA Corp.</button>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="loading">
                <p>üëÜ Selecciona un s√≠mbolo de acci√≥n para comenzar</p>
                <p style="margin-top: 1rem; opacity: 0.7;">Prueba haciendo clic en cualquiera de las acciones populares ‚¨ÖÔ∏è</p>
            </div>
        </div>
    </div>

    <script>
        let currentStockData = null;

        // Configuraci√≥n de colores
        const colors = {
            primary: '#00ff88',
            secondary: '#ff6b6b',
            background: '#0e1117',
            text: '#fafafa',
            grid: '#262730'
        };

        // Funci√≥n para cargar acciones de ejemplo
        function loadSampleStock(symbol) {
            document.getElementById('symbolInput').value = symbol;
            fetchStockData();
        }

        // Funci√≥n principal para obtener datos
        async function fetchStockData() {
            const symbol = document.getElementById('symbolInput').value.trim().toUpperCase();
            const period = document.getElementById('periodSelect').value;
            
            if (!symbol) {
                showError('Por favor ingresa un s√≠mbolo de acci√≥n v√°lido');
                return;
            }

            const btn = document.getElementById('fetchBtn');
            const mainContent = document.getElementById('mainContent');
            
            btn.disabled = true;
            btn.textContent = '‚è≥ Cargando...';
            
            mainContent.innerHTML = '<div class="loading"><p>Obteniendo datos para ' + symbol + '...</p></div>';

            try {
                // Simular datos financieros realistas basados en el s√≠mbolo
                const stockData = await generateStockData(symbol, period);
                
                if (stockData) {
                    currentStockData = stockData;
                    displayDashboard(stockData);
                    showSuccess('‚úÖ Datos cargados exitosamente para ' + symbol);
                } else {
                    throw new Error('No se encontraron datos para el s√≠mbolo: ' + symbol);
                }
                
            } catch (error) {
                showError('‚ùå Error cargando datos: ' + error.message);
                mainContent.innerHTML = '<div class="error">Error: ' + error.message + '</div>';
            } finally {
                btn.disabled = false;
                btn.textContent = 'üìä Obtener Datos';
            }
        }

        // Generar datos de acciones realistas
        async function generateStockData(symbol, period) {
            // Base de datos de empresas reales
            const companies = {
                'AAPL': { name: 'Apple Inc.', sector: 'Technology', basePrice: 190, volatility: 0.02 },
                'GOOGL': { name: 'Alphabet Inc.', sector: 'Technology', basePrice: 140, volatility: 0.025 },
                'MSFT': { name: 'Microsoft Corp.', sector: 'Technology', basePrice: 420, volatility: 0.02 },
                'TSLA': { name: 'Tesla Inc.', sector: 'Automotive', basePrice: 250, volatility: 0.04 },
                'AMZN': { name: 'Amazon.com Inc.', sector: 'E-commerce', basePrice: 150, volatility: 0.03 },
                'NVDA': { name: 'NVIDIA Corp.', sector: 'Technology', basePrice: 800, volatility: 0.035 },
                'META': { name: 'Meta Platforms Inc.', sector: 'Technology', basePrice: 350, volatility: 0.03 },
                'NFLX': { name: 'Netflix Inc.', sector: 'Entertainment', basePrice: 450, volatility: 0.03 }
            };

            const company = companies[symbol];
            if (!company) {
                return null;
            }

            // Generar d√≠as seg√∫n el per√≠odo
            const days = {
                '1mo': 30,
                '3mo': 90,
                '6mo': 180,
                '1y': 365,
                '2y': 730,
                '5y': 1825
            }[period] || 365;

            const data = [];
            let currentPrice = company.basePrice;
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);

            for (let i = 0; i < days; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                // Simular variaci√≥n de precios realista
                const change = (Math.random() - 0.5) * 2 * company.volatility;
                currentPrice *= (1 + change);
                
                const high = currentPrice * (1 + Math.random() * 0.02);
                const low = currentPrice * (1 - Math.random() * 0.02);
                const open = currentPrice * (1 + (Math.random() - 0.5) * 0.01);
                const volume = Math.floor(Math.random() * 50000000) + 10000000;

                data.push({
                    date: date.toISOString().split('T')[0],
                    open: open,
                    high: Math.max(high, open, currentPrice),
                    low: Math.min(low, open, currentPrice),
                    close: currentPrice,
                    volume: volume
                });
            }

            // Calcular m√©tricas
            const latestPrice = data[data.length - 1].close;
            const previousPrice = data[data.length - 2]?.close || latestPrice;
            const change = latestPrice - previousPrice;
            const changePercent = (change / previousPrice) * 100;

            return {
                symbol: symbol,
                companyName: company.name,
                sector: company.sector,
                currentPrice: latestPrice,
                change: change,
                changePercent: changePercent,
                data: data,
                metrics: calculateMetrics(data, company)
            };
        }

        // Calcular m√©tricas financieras
        function calculateMetrics(data, company) {
            const prices = data.map(d => d.close);
            const volumes = data.map(d => d.volume);
            
            return {
                marketCap: Math.floor(Math.random() * 2000000000000) + 100000000000,
                peRatio: Math.floor(Math.random() * 30) + 15,
                high52w: Math.max(...prices) * 1.1,
                low52w: Math.min(...prices) * 0.9,
                avgVolume: volumes.reduce((a, b) => a + b, 0) / volumes.length,
                beta: Math.random() * 1.5 + 0.5,
                dividendYield: Math.random() * 3
            };
        }

        // Mostrar dashboard completo
        function displayDashboard(stockData) {
            const mainContent = document.getElementById('mainContent');
            
            mainContent.innerHTML = `
                <div class="metrics-grid">
                    ${createMetricCard('Precio Actual', formatCurrency(stockData.currentPrice), formatChange(stockData.change, stockData.changePercent))}
                    ${createMetricCard('Cap. de Mercado', formatLargeNumber(stockData.metrics.marketCap))}
                    ${createMetricCard('P/E Ratio', stockData.metrics.peRatio.toFixed(2))}
                    ${createMetricCard('M√°ximo 52s', formatCurrency(stockData.metrics.high52w))}
                    ${createMetricCard('M√≠nimo 52s', formatCurrency(stockData.metrics.low52w))}
                    ${createMetricCard('Beta', stockData.metrics.beta.toFixed(2))}
                </div>

                <div class="chart-container">
                    <h3 style="color: #00ff88; margin-bottom: 1rem;">üìä Gr√°fico de Precios - ${stockData.symbol}</h3>
                    <div id="priceChart" style="height: 400px;"></div>
                </div>

                <div class="chart-container">
                    <h3 style="color: #00ff88; margin-bottom: 1rem;">üìà Volumen de Trading</h3>
                    <div id="volumeChart" style="height: 300px;"></div>
                </div>

                <div class="data-table">
                    <h3 style="color: #00ff88; margin-bottom: 1rem;">üìã Datos Hist√≥ricos Recientes</h3>
                    ${createDataTable(stockData.data.slice(-10))}
                    <button class="download-btn" onclick="downloadCSV()">üì• Descargar CSV Completo</button>
                </div>
            `;

            // Crear gr√°ficos
            createPriceChart(stockData);
            createVolumeChart(stockData);
        }

        // Crear tarjeta de m√©trica
        function createMetricCard(title, value, change = '') {
            return `
                <div class="metric-card">
                    <div class="metric-title">${title}</div>
                    <div class="metric-value">${value}</div>
                    ${change ? `<div class="metric-change ${change.includes('-') ? 'negative' : 'positive'}">${change}</div>` : ''}
                </div>
            `;
        }

        // Crear gr√°fico de precios
        function createPriceChart(stockData) {
            const trace = {
                x: stockData.data.map(d => d.date),
                y: stockData.data.map(d => d.close),
                type: 'scatter',
                mode: 'lines',
                name: 'Precio de Cierre',
                line: { color: colors.primary, width: 2 }
            };

            const layout = {
                title: `${stockData.companyName} (${stockData.symbol})`,
                xaxis: { title: 'Fecha', color: colors.text },
                yaxis: { title: 'Precio ($)', color: colors.text, tickformat: '$.2f' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: colors.text },
                margin: { t: 50, r: 50, b: 50, l: 80 }
            };

            Plotly.newPlot('priceChart', [trace], layout, { responsive: true });
        }

        // Crear gr√°fico de volumen
        function createVolumeChart(stockData) {
            const trace = {
                x: stockData.data.map(d => d.date),
                y: stockData.data.map(d => d.volume),
                type: 'bar',
                name: 'Volumen',
                marker: { color: colors.primary, opacity: 0.7 }
            };

            const layout = {
                title: 'Volumen de Trading',
                xaxis: { title: 'Fecha', color: colors.text },
                yaxis: { title: 'Volumen', color: colors.text },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: colors.text },
                margin: { t: 50, r: 50, b: 50, l: 80 }
            };

            Plotly.newPlot('volumeChart', [trace], layout, { responsive: true });
        }

        // Crear tabla de datos
        function createDataTable(data) {
            let table = `
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Apertura</th>
                            <th>M√°ximo</th>
                            <th>M√≠nimo</th>
                            <th>Cierre</th>
                            <th>Volumen</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.reverse().forEach(row => {
                table += `
                    <tr>
                        <td>${row.date}</td>
                        <td>${formatCurrency(row.open)}</td>
                        <td>${formatCurrency(row.high)}</td>
                        <td>${formatCurrency(row.low)}</td>
                        <td>${formatCurrency(row.close)}</td>
                        <td>${row.volume.toLocaleString()}</td>
                    </tr>
                `;
            });

            table += '</tbody></table>';
            return table;
        }

        // Descargar CSV
        function downloadCSV() {
            if (!currentStockData) return;
            
            let csv = 'Fecha,Apertura,M√°ximo,M√≠nimo,Cierre,Volumen\n';
            currentStockData.data.forEach(row => {
                csv += `${row.date},${row.open.toFixed(2)},${row.high.toFixed(2)},${row.low.toFixed(2)},${row.close.toFixed(2)},${row.volume}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentStockData.symbol}_datos_financieros_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Funciones auxiliares
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(value);
        }

        function formatLargeNumber(value) {
            if (value >= 1e12) return (value / 1e12).toFixed(1) + 'T';
            if (value >= 1e9) return (value / 1e9).toFixed(1) + 'B';
            if (value >= 1e6) return (value / 1e6).toFixed(1) + 'M';
            return value.toLocaleString();
        }

        function formatChange(change, percent) {
            const sign = change >= 0 ? '+' : '';
            return `${sign}${formatCurrency(change)} (${sign}${percent.toFixed(2)}%)`;
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.body.insertBefore(errorDiv, document.body.firstChild);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.body.insertBefore(successDiv, document.body.firstChild);
            setTimeout(() => successDiv.remove(), 3000);
        }

        // Permitir presionar Enter para buscar
        document.getElementById('symbolInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fetchStockData();
            }
        });

        // Cargar AAPL por defecto
        window.addEventListener('load', function() {
            setTimeout(() => {
                fetchStockData();
            }, 1000);
        });
    </script>
</body>
</html>